syntax = "proto3";
package v1.public.events.fusion.log;
option go_package = "github.com/dbt-labs/proto-golang/v1/public/events/fusion/log";

import "dbtlabs/proto/public/v1/events/fusion/compat/otlp.proto";
import "dbtlabs/proto/public/v1/events/fusion/phase/phase.proto";

// Generic event for log messages that do not cary special meaning
// or additional metadata beyond the standard fields
message LogMessage {
  // Optional fusion error/warning code
  optional uint32 code = 1;

  // Optional legacy dbt-core code (e.g. "Z048") if this event has a strict mapping to a dbt core event.
  optional string dbt_core_event_code = 2;

  // Original severity before user up/down-grade configuration applied.
  v1.public.events.fusion.compat.SeverityNumber original_severity_number = 3;
  string original_severity_text = 4;

  // If this log message is emitted in the context of a specific node,
  // this field should be set to the node's unique FQN.
  optional string unique_id = 5;

  // Fusion source code file name where the log was created. Only available in debug builds.
  optional string file = 6;

  // Fusion source code file line number where the log was created. Only available in debug builds.
  optional uint32 line = 7;

  // Execution phase (if known) during which this log was emitted.
  optional v1.public.events.fusion.phase.ExecutionPhase phase = 8;

  // Package name of the project dependency for which this log was emitted. Not set for the root project.
  optional string package_name = 9;
}

// Event emitted when user explicitly logs messages via jinja's print() or log() functions.
// This event maps to dbt-core's JinjaLogInfo (I061-I063) events.
message UserLogMessage {
  // True if this message was emitted via print(), false if via log()
  bool is_print = 1;

  // Legacy dbt-core event code:
  // - "I062" (JinjaLogInfo) for log info level
  // - "I063" (JinjaLogDebug) for log debug level
  // - "I061" (JinjaLogWarning) for log warning level
  // - "Z052" (PrintEvent) for print statements
  string dbt_core_event_code = 2;

  // If this log message is emitted in the context of a specific node,
  // this field should be set to the node's unique FQN.
  optional string unique_id = 3;

  // Execution phase (if known) during which this log was emitted.
  optional v1.public.events.fusion.phase.ExecutionPhase phase = 4;

  // Package name (project or dependency) from which this log was emitted.
  optional string package_name = 5;

  // Location within the SQL/Jinja file where print() or log() was called.
  // Line number (1-indexed) of the print/log call in the SQL file.
  optional uint32 line = 6;

  // Column number (0-indexed) of the print/log call in the SQL file.
  optional uint32 column = 7;

  // Relative path to the SQL file containing the print/log call.
  optional string relative_path = 8;
}
